<div class="wrapper">
    <nav id="sidebar" class="sidebar js-sidebar">
      <div class="sidebar-content js-simplebar">
        <a class="sidebar-brand" href="/home">
          <img src="assets/images/logo_BDMS.png" class="align-middle" style="height: 30px;">
        </a>        <ul class="sidebar-nav">
            <li class="sidebar-header">
                Pages
            </li>            
            <li class="sidebar-item ">
                <a class="sidebar-link" href="home">
            <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Dashboard</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/users">
                <i class="align-middle" data-feather="user"></i> <span class="align-middle">Liste des utilisateurs</span>
                </a>
            </li>
            <li class="sidebar-header">
                Administration
            </li>
            <li class="sidebar-item active">
                <a class="sidebar-link" href="/jourferie">
                <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Jour F√©ri√©</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/typeteneur">
                <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Type Teneur</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/compteteneur">
                <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Compte Teneur</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/tmm">
                <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">TMM</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/devises">
                <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Devises</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/tauxcharge">
                <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Taux Charges</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/typemarche">
                <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Type Marche</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/commissionHE">
                <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Commision HorsElec</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/commissionE">
                <i class="align-middle" data-feather="calendar"></i> <span class="align-middle">Commision Elec</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/categorieavoir">
                <i class="align-middle" data-feather="folder"></i> <span class="align-middle">Categorie d'Avoir</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/groupes">
                <i class="align-middle" data-feather="folder"></i> <span class="align-middle">Groupes</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/indicesectoriel">
                <i class="align-middle" data-feather="folder"></i> <span class="align-middle">Indice Sectoriel</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a class="sidebar-link" href="/naturereferentiel">
                <i class="align-middle" data-feather="folder"></i> <span class="align-middle">Nature R√©ferentiel</span>
                </a>
            </li>
        </ul>
      </div>
    </nav>
  
    <div class="main">
      <nav class="navbar navbar-expand navbar-light navbar-bg">
        <a class="sidebar-toggle js-sidebar-toggle">
          <i class="hamburger align-self-center"></i>
        </a>
  
        <div class="navbar-collapse collapse">
          <ul class="navbar-nav navbar-align">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                <!-- Image with fallback -->
                <img [src]="getUserImagePath() || '/assets/images/default-avatar.png'"
                     class="avatar img-fluid rounded me-1"
                     style="width: 32px; height: 32px; object-fit: cover;"
                     onerror="this.onerror=null;this.src='/assets/images/default-avatar.png'">
                
                <span class="text-dark" *ngIf="user">
                  {{ user.username || user.preferred_username || user.name || 'No username' }}
                </span>
              </a>  
              <div class="dropdown-menu dropdown-menu-end">
                <a class="dropdown-item" href="/profile"><i class="align-middle me-1" data-feather="user"></i> Profile</a>
                <a class="dropdown-item" href="#" (click)="logout(); $event.preventDefault()"><i class="align-middle me-1" data-feather="log-out"></i> Log out</a>
              </div>
            </li>
          </ul>
        </div>
      </nav>
  
      <div class="container">
        <div class="header-container">
          <div class="header-blue-line"></div>
          <div class="header-bar">
            <h2>Liste des Jours F√©ri√©s</h2>
            <button class="btn-add" (click)="displayModal = true">
              <span class="add-icon">+</span> Ajouter un Jour F√©ri√©
            </button>
          </div>
        </div>


        <main class="content">
            <div class="container-fluid p-0">
              <div class="row">
                <div class="col-12 d-flex">
                  <div class="card flex-fill">
                    <div class="card-header">
                      <h5 class="card-title mb-0">Calendrier des Jours F√©ri√©s</h5>
                    </div>
                    <div class="card-body d-flex">
                      <div class="align-self-center w-100">
                        <full-calendar #fullCalendar [options]="calendarOptions"></full-calendar>
                      </div>
                    </div>
                    
                    <div class="mt-4" *ngIf="joursFeriesDynamiques.length > 0">
                      <h6 class="text-muted" style="font-size: 14px;">
                        üìÖ Jours F√©ri√©s Ajout√©s Manuellement :
                      </h6>
                      <ul class="list-unstyled">
                        <li *ngFor="let jour of joursFeriesDynamiques"
                            class="d-flex align-items-center"
                            style="font-size: 12px;">
                          <div>
                            <strong>{{ jour.descriptionfr }}</strong> ‚Äî <span>{{ jour.date }}</span>
                          </div>
                          <button class="btn btn-sm btn-outline-danger" (click)="confirmDeleteJour(jour.id)">
                            <i class="pi pi-trash"></i>
                          </button>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </main>
          




          <p-dialog [(visible)]="displayModal" [modal]="true" [style]="{width: '50vw'}" header="Ajouter un jour f√©ri√©">
            <form [formGroup]="jourFerieForm" (ngSubmit)="confirmAddJour()">
              <div class="p-fluid">
                <div class="form-group mb-3">
                  <label>Date <span class="text-danger">*</span></label>
                  <input type="date" class="form-control" formControlName="date" [ngClass]="{'is-invalid': jourFerieForm.get('date')?.invalid && jourFerieForm.get('date')?.touched}">
                  <div *ngIf="jourFerieForm.get('date')?.invalid && jourFerieForm.get('date')?.touched" class="invalid-feedback">
                    La date est requise.
                  </div>
                </div>
          
                <div class="form-group mb-3">
                  <label>Description FR <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" formControlName="descriptionfr" [ngClass]="{'is-invalid': jourFerieForm.get('descriptionfr')?.invalid && jourFerieForm.get('descriptionfr')?.touched}">
                  <div *ngIf="jourFerieForm.get('descriptionfr')?.invalid && jourFerieForm.get('descriptionfr')?.touched" class="invalid-feedback">
                    Veuillez entrer une description valide (2 caract√®res minimum).
                  </div>
                </div>
          
                <!-- Optional Fields -->
                <div class="form-group mb-3"><label>R√©sum√© FR</label><input type="text" class="form-control" formControlName="resumefr"></div>
                <div class="form-group mb-3"><label>Description AR</label><input type="text" class="form-control" formControlName="descriptionar"></div>
                <div class="form-group mb-3"><label>R√©sum√© AR</label><input type="text" class="form-control" formControlName="resumear"></div>
                <div class="form-group mb-3"><label>Description EN</label><input type="text" class="form-control" formControlName="descriptionen"></div>
                <div class="form-group mb-3"><label>R√©sum√© EN</label><input type="text" class="form-control" formControlName="resumeen"></div>
          
                <button type="submit" class="btn btn-success" [disabled]="jourFerieForm.invalid">Confirmer</button>
              </div>
            </form>
          </p-dialog>
          
          <!-- Confirmation Dialog -->
          <p-confirmDialog></p-confirmDialog>
          <p-toast></p-toast>
          
  